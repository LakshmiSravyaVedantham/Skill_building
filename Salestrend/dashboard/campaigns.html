<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campaign Analytics - Tesla Sales Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #0a0e27; color: #e4e7eb; }
        .sidebar { position: fixed; left: 0; top: 0; width: 260px; height: 100vh; background: linear-gradient(180deg, #1a1f3a 0%, #0f1729 100%); border-right: 1px solid rgba(255,255,255,0.05); padding: 30px 20px; z-index: 100; }
        .logo { font-size: 1.5rem; font-weight: 700; color: #fff; margin-bottom: 40px; display: flex; align-items: center; gap: 10px; }
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; margin-bottom: 8px; border-radius: 10px; color: #9ca3af; text-decoration: none; transition: all 0.2s; }
        .nav-item:hover, .nav-item.active { background: rgba(99, 102, 241, 0.1); color: #6366f1; }
        .main-content { margin-left: 260px; padding: 30px 40px; }
        .header { margin-bottom: 30px; }
        .header h1 { font-size: 2rem; font-weight: 700; color: #fff; margin-bottom: 8px; }
        .header p { color: #9ca3af; font-size: 0.95rem; }
        .status-badge { display: inline-block; padding: 6px 16px; border-radius: 16px; font-size: 0.85rem; margin-top: 12px; margin-right: 10px; }
        .status-demo { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: #fff; }
        .status-live { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: #fff; }
        .refresh-btn { background: rgba(99, 102, 241, 0.15); color: #818cf8; border: 1px solid rgba(99, 102, 241, 0.3); padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 0.9rem; }
        .refresh-btn:hover { background: rgba(99, 102, 241, 0.25); }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 1px solid rgba(255,255,255,0.05); border-radius: 16px; padding: 24px; }
        .card-title { font-size: 0.85rem; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px; }
        .card-value { font-size: 2.5rem; font-weight: 700; color: #fff; margin-bottom: 8px; }
        .card-subtitle { font-size: 0.9rem; color: #6b7280; }
        .chart-container { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 1px solid rgba(255,255,255,0.05); border-radius: 16px; padding: 24px; margin-bottom: 20px; }
        .chart-title { font-size: 1.2rem; font-weight: 600; color: #fff; margin-bottom: 20px; }
        .chart-wrapper { position: relative; height: 300px; }
        .demo-notice { background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); color: #fbbf24; padding: 16px; border-radius: 8px; margin-bottom: 20px; font-size: 0.9rem; }
        .loading { text-align: center; padding: 40px; color: #6b7280; }
        .data-source { font-size: 0.75rem; color: #6b7280; margin-top: 12px; }
        .trend-up { color: #10b981; }
        .trend-down { color: #ef4444; }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="logo"><span>‚ö°</span><span>TeslaTrend</span></div>
        <nav>
            <a href="index.html" class="nav-item"><span>üìä</span><span>Dashboard</span></a>
            <a href="videos.html" class="nav-item"><span>üé¨</span><span>AI Videos</span></a>
            <a href="analytics.html" class="nav-item"><span>üìà</span><span>Analytics</span></a>
            <a href="campaigns.html" class="nav-item active"><span>üéØ</span><span>Campaigns</span></a>
            <a href="settings.html" class="nav-item"><span>‚öôÔ∏è</span><span>Settings</span></a>
        </nav>
    </div>

    <div class="main-content">
        <div class="header">
            <h1>Campaign Performance Analytics</h1>
            <p>Visual analytics for marketing campaigns with real-time social media data</p>
            <span class="status-badge status-demo">‚ö†Ô∏è Demo Mode</span>
            <span class="status-badge status-live">üü¢ Social Data Live</span>
            <button class="refresh-btn" onclick="loadAllData()">üîÑ Refresh Data</button>
        </div>

        <div class="demo-notice">
            <strong>‚ö†Ô∏è Demo Mode:</strong> Campaign performance data requires integration with TikTok Ads API, Google Ads API, or Meta Ads API. 
            The graphs below show demo data structure. Social media trends are fetched from available APIs.
        </div>

        <div class="grid" id="statsGrid">
            <div class="card">
                <div class="card-title">Total Impressions</div>
                <div class="card-value" id="totalImpressions">-</div>
                <div class="card-subtitle">Across all campaigns</div>
            </div>
            <div class="card">
                <div class="card-title">Click-Through Rate</div>
                <div class="card-value" id="avgCTR">-</div>
                <div class="card-subtitle">Average CTR</div>
            </div>
            <div class="card">
                <div class="card-title">Engagement Rate</div>
                <div class="card-value" id="engagementRate">-</div>
                <div class="card-subtitle">Social engagement</div>
            </div>
            <div class="card">
                <div class="card-title">Cost Per Click</div>
                <div class="card-value" id="avgCPC">-</div>
                <div class="card-subtitle">Average CPC</div>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-title">Campaign Performance Over Time</div>
            <div class="chart-wrapper">
                <canvas id="performanceChart"></canvas>
            </div>
            <div class="data-source">Demo data - Connect ad platforms for real metrics</div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
            <div class="chart-container">
                <div class="chart-title">Impressions by Campaign</div>
                <div class="chart-wrapper">
                    <canvas id="impressionsChart"></canvas>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-title">Engagement by Platform</div>
                <div class="chart-wrapper">
                    <canvas id="platformChart"></canvas>
                </div>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-title">Campaign ROI Comparison</div>
            <div class="chart-wrapper">
                <canvas id="roiChart"></canvas>
            </div>
            <div class="data-source">Demo data - Requires ad platform integration</div>
        </div>

        <div class="chart-container" id="socialTrendsContainer">
            <div class="chart-title">Social Media Trends (Live Data)</div>
            <div id="socialTrendsContent" class="loading">Loading social media data...</div>
        </div>
    </div>

    <script>
        const API = 'http://localhost:5001';
        let charts = {};

        // Demo campaign data structure
        const demoCampaignData = {
            campaigns: [
                { name: "Tesla Model Y Launch", impressions: 1250000, clicks: 35000, ctr: 2.8, cpc: 0.45, engagement: 4.2 },
                { name: "Autopilot Feature", impressions: 980000, clicks: 28000, ctr: 2.86, cpc: 0.52, engagement: 3.8 },
                { name: "Supercharger Network", impressions: 750000, clicks: 21000, ctr: 2.8, cpc: 0.38, engagement: 3.5 },
                { name: "Performance Test Drive", impressions: 620000, clicks: 19000, ctr: 3.06, cpc: 0.48, engagement: 4.5 }
            ],
            timeline: [
                { date: "Week 1", impressions: 450000, clicks: 12500, engagement: 3.8 },
                { date: "Week 2", impressions: 520000, clicks: 14800, engagement: 4.1 },
                { date: "Week 3", impressions: 680000, clicks: 19200, engagement: 4.3 },
                { date: "Week 4", impressions: 750000, clicks: 22500, engagement: 4.5 },
                { date: "Week 5", impressions: 820000, clicks: 25000, engagement: 4.2 }
            ],
            platforms: {
                TikTok: 45,
                Instagram: 30,
                YouTube: 15,
                Twitter: 10
            }
        };

        async function loadAllData() {
            loadDemoData();
            await loadSocialTrends();
        }

        function loadDemoData() {
            // Update stats
            const totalImpressions = demoCampaignData.campaigns.reduce((sum, c) => sum + c.impressions, 0);
            const totalClicks = demoCampaignData.campaigns.reduce((sum, c) => sum + c.clicks, 0);
            const avgCTR = (totalClicks / totalImpressions * 100).toFixed(2);
            const avgEngagement = (demoCampaignData.campaigns.reduce((sum, c) => sum + c.engagement, 0) / demoCampaignData.campaigns.length).toFixed(1);
            const avgCPC = (demoCampaignData.campaigns.reduce((sum, c) => sum + c.cpc, 0) / demoCampaignData.campaigns.length).toFixed(2);

            document.getElementById('totalImpressions').textContent = (totalImpressions / 1000000).toFixed(2) + 'M';
            document.getElementById('avgCTR').textContent = avgCTR + '%';
            document.getElementById('engagementRate').textContent = avgEngagement + '%';
            document.getElementById('avgCPC').textContent = '$' + avgCPC;

            // Create charts
            createPerformanceChart();
            createImpressionsChart();
            createPlatformChart();
            createROIChart();
        }

        function createPerformanceChart() {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            if (charts.performance) charts.performance.destroy();

            charts.performance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: demoCampaignData.timeline.map(t => t.date),
                    datasets: [
                        {
                            label: 'Impressions',
                            data: demoCampaignData.timeline.map(t => t.impressions),
                            borderColor: '#6366f1',
                            backgroundColor: 'rgba(99, 102, 241, 0.1)',
                            yAxisID: 'y',
                            tension: 0.4
                        },
                        {
                            label: 'Clicks',
                            data: demoCampaignData.timeline.map(t => t.clicks),
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            yAxisID: 'y1',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: { labels: { color: '#e4e7eb' } }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            ticks: { color: '#9ca3af' },
                            grid: { color: 'rgba(255,255,255,0.05)' }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            ticks: { color: '#9ca3af' },
                            grid: { drawOnChartArea: false }
                        },
                        x: {
                            ticks: { color: '#9ca3af' },
                            grid: { color: 'rgba(255,255,255,0.05)' }
                        }
                    }
                }
            });
        }

        function createImpressionsChart() {
            const ctx = document.getElementById('impressionsChart').getContext('2d');
            if (charts.impressions) charts.impressions.destroy();

            charts.impressions = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: demoCampaignData.campaigns.map(c => c.name),
                    datasets: [{
                        label: 'Impressions',
                        data: demoCampaignData.campaigns.map(c => c.impressions),
                        backgroundColor: ['#6366f1', '#8b5cf6', '#ec4899', '#f59e0b']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            ticks: { color: '#9ca3af' },
                            grid: { color: 'rgba(255,255,255,0.05)' }
                        },
                        x: {
                            ticks: { color: '#9ca3af', maxRotation: 45, minRotation: 45 },
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        function createPlatformChart() {
            const ctx = document.getElementById('platformChart').getContext('2d');
            if (charts.platform) charts.platform.destroy();

            charts.platform = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(demoCampaignData.platforms),
                    datasets: [{
                        data: Object.values(demoCampaignData.platforms),
                        backgroundColor: ['#6366f1', '#ec4899', '#f59e0b', '#10b981']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#e4e7eb', padding: 15 }
                        }
                    }
                }
            });
        }

        function createROIChart() {
            const ctx = document.getElementById('roiChart').getContext('2d');
            if (charts.roi) charts.roi.destroy();

            const roiData = demoCampaignData.campaigns.map(c => ({
                name: c.name,
                roi: ((c.clicks * 50 - c.impressions * c.cpc / 1000) / (c.impressions * c.cpc / 1000) * 100).toFixed(0)
            }));

            charts.roi = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: roiData.map(d => d.name),
                    datasets: [{
                        label: 'ROI %',
                        data: roiData.map(d => d.roi),
                        backgroundColor: roiData.map(d => d.roi > 0 ? '#10b981' : '#ef4444')
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#9ca3af',
                                callback: function(value) { return value + '%'; }
                            },
                            grid: { color: 'rgba(255,255,255,0.05)' }
                        },
                        y: {
                            ticks: { color: '#9ca3af' },
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        async function loadSocialTrends() {
            const container = document.getElementById('socialTrendsContent');
            try {
                const data = await res.json();
                
                if (data.note) {
                    container.innerHTML = `
                        <div style="padding: 20px; text-align: center;">
                            <p style="color: #9ca3af; margin-bottom: 16px;">${data.note}</p>
                            <p style="color: #6b7280; font-size: 0.9rem;">
                                To get real TikTok campaign data, you need:
                            </p>
                            <ul style="list-style: none; padding: 0; margin-top: 12px; color: #9ca3af; font-size: 0.9rem;">
                                <li>‚Ä¢ TikTok Business Account</li>
                                <li>‚Ä¢ TikTok Ads Manager Access</li>
                                <li>‚Ä¢ API Authentication Token</li>
                            </ul>
                        </div>
                    `;
                } else if (data.trending_hashtags) {
                    container.innerHTML = data.trending_hashtags.map(tag => `
                        <div style="padding: 12px; background: rgba(255,255,255,0.03); border-radius: 8px; margin-bottom: 8px;">
                            <strong style="color: #fff;">${tag.tag}</strong>
                            <span style="color: #10b981; margin-left: 12px;">${tag.growth}</span>
                            <span style="color: #6b7280; margin-left: 12px;">${tag.views.toLocaleString()} views</span>
                        </div>
                    `).join('');
                }
            } catch (e) {
                container.innerHTML = `<div style="color: #ef4444; padding: 20px;">Failed to load social trends</div>`;
            }
        }

        // Load data on page load
        window.addEventListener('DOMContentLoaded', loadAllData);
    </script>
</body>
</html>
